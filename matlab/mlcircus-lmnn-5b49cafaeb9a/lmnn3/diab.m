clc

%setpaths3
 
 close all
 
 %%
 
for i=1:20
%h=fig('units','inches','width',10,'height',10,'font','Helvetica','fontsize',25)
end

fileName = '../../../python/OurMethod/src/datasets/diabetes_scale.txt_mTraing'
%fileName = '../../../python/OurMethod/src/datasets/cod-rna.txt_mTraing'

%fileName = '../../../python/OurMethod/src/datasets/heart_scale.txt_mTraing'

%fileName='../../../python/OurMethod/src/datasets/liver-disorders_scale.txt_mTraing'


fileName = '../../../python/OurMethod/src/datasets/fourclass_scale.txt_mTraing'

fileName = '../../../python/OurMethod/src/datasets/iris.scale.txt_mTraing'
classes=3
name='Iris'

data = importfile(fileName)
%fileName = '../../../python/OurMethod/src/datasets/diabetes_scale.txt_mTest'
%data2 = importfile(fileName)

Yall=data(:,1);
Yall = Yall-1;
Xall = data(:,2:end);

%Yall = [Yall; data2(:,1)];
%Xall = [Xall; data2(:,2:end)];



 B=[ 0.12266619  0.01788651 -0.00491996  0.04007432 -0.03256207 -0.03621984   -0.01777811 -0.01490885
  0.01788651  0.13464238  0.09733066 -0.03782223 -0.0142261  -0.04247308   -0.05512744 -0.0213258 
 -0.00491996  0.09733066  0.13938937 -0.02078175 -0.00853266 -0.06338376   -0.00059186 -0.03040279
  0.04007432 -0.03782223 -0.02078175  0.13444916  0.00280554 -0.07290686   -0.01063437 -0.01291746
 -0.03256207 -0.0142261  -0.00853266  0.00280554  0.04404951 -0.01499042    0.01587605 -0.0219039 
 -0.03621984 -0.04247308 -0.06338376 -0.07290686 -0.01499042  0.13608322    0.03058234  0.02460154
 -0.01777811 -0.05512744 -0.00059186 -0.01063437  0.01587605  0.03058234    0.07566468 -0.01934161
 -0.01490885 -0.0213258  -0.03040279 -0.01291746 -0.0219039   0.02460154   -0.01934161  0.11369542]



Bg=[ 0.13889653 -0.03295639  0.01030766  0.02636132  0.02312137  0.00335752    0.00811838 -0.04012725
 -0.03295639  0.15525355 -0.01053848 -0.03141781 -0.08053429 -0.00514069   -0.01457563 -0.04151092
  0.01030766 -0.01053848  0.11904759 -0.05998361  0.0015048  -0.01495714   -0.00059692  0.02145921
  0.02636132 -0.03141781 -0.05998361  0.18257022  0.00391918 -0.02178985   -0.02621154 -0.04636817
  0.02312137 -0.08053429  0.0015048   0.00391918  0.13512717  0.01171543    0.01526845  0.03035124
  0.00335752 -0.00514069 -0.01495714 -0.02178985  0.01171543  0.13026298   -0.01954938  0.01477939
  0.00811838 -0.01457563 -0.00059692 -0.02621154  0.01526845 -0.01954938    0.12953262  0.0490067 
 -0.04012725 -0.04151092  0.02145921 -0.04636817  0.03035124  0.01477939    0.0490067   0.20949176]


BfourClass = [ 0.09943548  0.02529262 
   0.02529262  0.22061548]

BfourClass =[ 0.07564176  0.02510342 
   0.02510342  0.23865714]
BfourClass =[0.06398426  0.02145704 
   0.02145704  0.2412112]


BOLD=[  1.88436300e+00   1.17356915e+01  -4.21992425e+02  -4.97889915e+02    8.14872250e+02  -6.31632350e+02  -1.58303325e+03   1.47890280e+01
   1.17356915e+01   2.75346570e+02   8.35636250e+03   1.59059765e+04     2.02788845e+04   2.05203430e+04   2.18713180e+04   3.46124525e+04
  -4.21992425e+02   8.35636250e+03   1.87607460e+07   1.49689040e+07     2.78217715e+07  -2.62851670e+05  -1.47244055e+06  -4.14646740e+06
  -4.97889915e+02   1.59059765e+04   1.49689040e+07   3.83046770e+07     5.02764500e+07   1.84684700e+06  -3.54394050e+06  -3.16493180e+06
   8.14872250e+02   2.02788845e+04   2.78217715e+07   5.02764500e+07     8.08678940e+07  -2.05413960e+06  -9.20202200e+06  -1.22612445e+07
  -6.31632350e+02   2.05203430e+04  -2.62851670e+05   1.84684700e+06    -2.05413960e+06   2.23346970e+07   1.73122020e+07   3.02423510e+07
  -1.58303325e+03   2.18713180e+04  -1.47244055e+06  -3.54394050e+06    -9.20202200e+06   1.73122020e+07   7.65785720e+07   8.26288700e+07
   1.47890280e+01   3.46124525e+04  -4.14646740e+06  -3.16493180e+06    -1.22612445e+07   3.02423510e+07   8.26288700e+07   1.12035350e+08]


Bheart =  [  2.02406390e-01   7.25185750e-03   1.11626380e-02  -7.36262000e-03    -3.47085840e-02  -9.04447650e-03  -1.09377480e-03   8.04297200e-02     5.62644250e-04   2.34298065e-02   2.38057595e-04  -3.01122935e-02     5.17484400e-03
     7.25185750e-03   4.42796290e-02   6.76939600e-03   1.62046090e-02     4.62013630e-02   4.21475645e-03  -5.86748300e-03  -4.94187280e-03    -5.56559950e-03   2.03792760e-02  -4.93100230e-03   1.03286470e-04    -1.18228780e-02
     1.11626380e-02   6.76939600e-03   5.63836650e-02   1.59343995e-02    -1.56924920e-02  -3.97278010e-03   3.14817935e-03   2.98645000e-02    -6.54943550e-03  -1.90030275e-02   7.68356600e-03  -1.19944945e-02    -1.09996045e-02
    -7.36262000e-03   1.62046090e-02   1.59343995e-02   1.42862110e-01     2.89561640e-02   5.92351700e-03  -1.13022490e-02   7.98428800e-03    -1.28760790e-02   1.39691095e-03  -1.08408665e-02  -1.40293020e-02    -1.90374645e-02
    -3.47085840e-02   4.62013630e-02  -1.56924920e-02   2.89561640e-02     2.13750540e-01   2.99700845e-03  -1.85602430e-02  -3.01842510e-02    -8.83104750e-03   1.97128070e-02   6.04679300e-03   7.97465300e-03    -2.31324735e-02
    -9.04447650e-03   4.21475645e-03  -3.97278010e-03   5.92351700e-03     2.99700845e-03   3.58895970e-02   4.25273070e-03  -1.69266590e-02     1.19625995e-03   8.37668100e-03  -1.67185590e-03   4.93517860e-03    -1.00478635e-02
    -1.09377480e-03  -5.86748300e-03   3.14817935e-03  -1.13022490e-02    -1.85602430e-02   4.25273070e-03   2.29120310e-02   1.55084850e-03    -1.92647950e-03   9.37538450e-03  -6.44878800e-03  -4.92000675e-03     6.36268250e-04
     8.04297200e-02  -4.94187280e-03   2.98645000e-02   7.98428800e-03    -3.01842510e-02  -1.69266590e-02   1.55084850e-03   1.77019020e-01     9.87898500e-03   4.05535955e-03   1.15665140e-02  -3.24163135e-03    -7.01763250e-03
     5.62644250e-04  -5.56559950e-03  -6.54943550e-03  -1.28760790e-02    -8.83104750e-03   1.19625995e-03  -1.92647950e-03   9.87898500e-03     2.67866350e-02   5.03139700e-03  -6.83255150e-04   1.57347765e-03    -2.40842625e-03
     2.34298065e-02   2.03792760e-02  -1.90030275e-02   1.39691095e-03     1.97128070e-02   8.37668100e-03   9.37538450e-03   4.05535955e-03     5.03139700e-03   1.97089450e-01  -6.22251400e-02  -9.28384250e-03    -3.75099460e-02
     2.38057595e-04  -4.93100230e-03   7.68356600e-03  -1.08408665e-02     6.04679300e-03  -1.67185590e-03  -6.44878800e-03   1.15665140e-02    -6.83255150e-04  -6.22251400e-02   6.06804020e-02   7.97354600e-03     1.62429225e-03
    -3.01122935e-02   1.03286470e-04  -1.19944945e-02  -1.40293020e-02     7.97465300e-03   4.93517860e-03  -4.92000675e-03  -3.24163135e-03     1.57347765e-03  -9.28384250e-03   7.97354600e-03   4.58703440e-02    -6.42531600e-04
     5.17484400e-03  -1.18228780e-02  -1.09996045e-02  -1.90374645e-02    -2.31324735e-02  -1.00478635e-02   6.36268250e-04  -7.01763250e-03    -2.40842625e-03  -3.75099460e-02   1.62429225e-03  -6.42531600e-04     3.84152500e-02]
 

Bliver=[ 0.24827712 -0.08399983  0.0290321  -0.13942434 -0.02457504
 -0.08399983  0.21091535  0.03930653 -0.06014791  0.02572853
  0.0290321   0.03930653  0.19173993 -0.28617292 -0.05369774
 -0.13942434 -0.06014791 -0.28617292  0.76897263 -0.11146914
 -0.02457504  0.02572853 -0.05369774 -0.11146914  0.26516748]



Biris=[ 0.85926342 -0.33175872 -0.66198225  0.07048591
 -0.33175872  0.35957567  0.29488003 -0.02889363
 -0.66198225  0.29488003  1.4185935  -0.90626105
  0.07048591 -0.02889363 -0.90626105  0.94674152]


Biris= [ 0.64116433 -0.18334828 -0.48702212  0.04497108
 -0.18334828  0.22172959  0.02707609  0.11929241
 -0.48702212  0.02707609  1.1324451  -0.762047  
  0.04497108  0.11929241 -0.762047    0.89315679]



Biris = [ 0.62482444 -0.20133701 -0.44686448  0.00210405
 -0.20133701  0.18104093  0.11099112  0.07038069
 -0.44686448  0.11099112  1.3114023  -0.8868433
  0.00210405  0.07038069 -0.88684335  0.9947311 ]

Biris=[ 0.85691583 -0.31627119 -0.66244785  0.07604018
 -0.31627119  0.33215595  0.26590533 -0.01542466
 -0.66244785  0.26590533  1.4536675  -0.90708455
  0.07604018 -0.01542466 -0.90708455  0.91471916]


Biris=[ 0.67067074 -0.2240772  -0.49602446  0.02456465
 -0.2240772   0.2248166   0.14072835  0.05258616
 -0.49602446  0.14072835  1.2984115  -0.86871075
  0.02456465  0.05258616 -0.86871075  0.97640419]

%B = Bheart
%B=Bliver
%B=BfourClass
B=Biris
[n d ] = size(Xall)

MM = []
for j=1:n
   MM(j)=norm(Xall(j,:)  ) ;
end
M = max(MM);
%Xall = Xall / M;
 

ME = mean(Xall)
%Xall = Xall -ones(n,d)*diag( ME)
 

figure(11)
clf

figure(12)
clf
BSVD=Xall'*Xall
 
[U,S,V ] = svd(B) 
[US,SS,VS ] = svd(BSVD) 

for k=1:-1:0
    
    SCALE=zeros(classes)
    
for label=0:classes-1

idx = Yall==label
nn = sum(idx)

Y=Yall(idx)
X= Xall(idx,:) 

if k==0
    UU=U'  
   X=    diag(diag(  S .^0.5 ))* UU' *X'
   X=X'
  %X = X*LL'
  
end

[x,y] = meshgrid( [1,1:d],[1:1:nn]);
 
Z=[]


for i=1:nn
    for j=1:d
        Z(i,j) = X(i,j);
         
        
    end
end

if k==1
    UUS=US'  
   X=    diag(diag(  SS .^0.5 ))* UUS' *X'
   X=X'
  %X = X*LL'
  
end



SCALE(label+1,1)=min(min(Z))
SCALE(label+1,2)=max(max(Z))

   col={'ro','bd','k<'}
if k==0
 
   figure(11)
   plot (X(:,1),X(:,2) ,col{label+1},'MarkerSize',5,'MarkerFaceColor','auto','LineWidth',5)
    hold on
    
else    
     
   figure(12)
   plot (X(:,1),X(:,2) ,col{label+1})
    hold on  
end
figure(label+1+classes*k )
imagesc(1:d,1:nn,Z(:,1:end))
colorbar%('Location','NorthOutside')




%pause(10)
end

for label=0:classes-1
figure(label+1+classes*k )

 
title(sprintf('Class %d',label+1))
xlabel('feature')
ylabel('sample')
    set(gca, 'CLim', [  min(SCALE(:,1))  , max(SCALE(:,2)) ]);
 print('-depsc', sprintf('../../../icml2017/fig/distrib_%s_%d_%d.eps',name,label,k))

%close all
end
end
%%
 figure(11)
 legend('Class 1','Class 2', 'Class 3')
 print('-depsc', sprintf('../../../icml2017/fig/distrib_%s.eps',name))
 
 
 %%

figure(13)
imagesc(1:d,1:d,B)
colorbar
 print('-depsc', sprintf('../../../icml2017/fig/distrib_%s_B.eps',name))

close all